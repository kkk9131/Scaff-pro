# 実装ロードマップ（MVP → 拡張）

このドキュメントは、足場SaaSツールの開発ロードマップを大きく段階ごとに整理したものです。  
**開発方針**: UIを先に実装し、その後に機能を追加していく。まずキャンバス画面（Screen B）を完成させ、案件画面（Screen A）は後回しとする。

---

## フェーズ0: 開発環境構築

**目的**：開発に必要な基盤を整える。

- リポジトリ / プロジェクトセットアップ  
  - フロントエンド（Vite + React + TypeScript）の雛形作成。  
  - バックエンド（FastAPI + Python）の雛形作成。  
  - DB（PostgreSQL）の初期スキーマ作成。  
- 既存足場ロジックのラップ  
  - 既存 Python コードを `scaffold_logic` パッケージとして整理。  
  - ダミーの外周（単純な矩形）を入力として、足場計算が API 経由で呼べる状態にする。

---

## フェーズ1: Screen B（キャンバス画面）UI 構築

**目的**：キャンバス画面の UI を完成させる。機能はモック/スタブで代用し、まず画面として動く状態を作る。

### 1-1: レイアウト・基本構造

- メインレイアウトの構築
  - 中央：大キャンバスエリア
  - 左：ツールパレット
  - 右：サイドパネル（タブ切替）
  - 上部：案件名・表示タブ切替

### 1-2: キャンバスエリア UI

- 表示タブの実装
  - 「建物平面」タブ（背景図面＋足場オーバーレイ用）
  - 「建物立面」タブ
  - 「足場平面」タブ
  - 「3D」タブ（ワイヤーフレーム表示用）
  - 「アイソメ」タブ（建物アイソメ図＋足場、輪郭線ベース）
  - 「パース」タブ（透視図法表示）
- キャンバス基本機能
  - パン（ドラッグで移動）
  - ズーム（ホイールで拡大・縮小）
  - グリッド表示

### 1-3: 参照用図面ビューア UI

- フローティングパネルの実装
  - インポートした平面図・立面図を別タブ/ウィンドウで表示
  - 表示/非表示トグル（閉じる）
  - リサイズ（縮小・拡大）
  - ドラッグによる位置移動
  - メインキャンバス上でオーバーレイ表示

### 1-4: ツールパレット UI

- モード切替ボタン
  - 選択 / 移動モード
  - 外周編集モード（頂点追加・削除・移動）
  - 開口線指定モード
  - 将来：投げ縄選択モード
- 表示補助
  - グリッド ON/OFF
  - スナップ ON/OFF（直角・グリッド）

### 1-5: サイドパネル UI

- タブ切替の実装
  - 「建物・図面」タブ
    - 図面情報セクション（アップロード済みファイル一覧、スケール設定）
    - 外周情報セクション（頂点一覧、形状検証）
    - 高さ条件セクション（階数、階高、軒高など）
  - 「足場条件」タブ
    - テンプレ選択
    - 基本条件（スパン、階高ピッチ、控え条件など）
    - 面別条件
  - 「数量」タブ
    - 数量表（テーブル UI）
    - CSV / Excel ダウンロードボタン
  - 「チャット」タブ
    - AI エージェントとの対話 UI
    - 入力欄・応答表示エリア
  - 将来：「履歴」タブ

---

## フェーズ1 チェックリスト

| 状態 | タスク | メモ |
|------|--------|------|
| [ ] | フロントエンド雛形（Vite + React + TS）を作成 | `frontend/` ディレクトリ |
| [ ] | メインレイアウト（中央・左・右・上部）を構築 | レスポンシブ対応 |
| [ ] | キャンバスエリア＋表示タブ切替を実装 | 建物平面/立面/足場平面/3D/アイソメ/パース |
| [ ] | キャンバス基本操作（パン・ズーム・グリッド）を実装 | Konva.js 利用 |
| [ ] | 参照用図面ビューア（フローティングパネル）を実装 | 表示/非表示、リサイズ、移動 |
| [ ] | ツールパレット UI を実装 | モード切替ボタン群 |
| [ ] | サイドパネル（タブ切替）を実装 | 建物・図面/足場条件/数量/チャット |
| [ ] | 各タブ内のフォーム・テーブル UI を実装 | 入力はモックでOK |
| [ ] | 3D ビュー（Three.js）の基本表示を実装 | 回転・ズーム・平行移動 |
| [ ] | アイソメ・パースビューの基本表示を実装 | ワイヤーフレームベース |

---

## フェーズ2: キャンバス機能の実装

**目的**：フェーズ1で作成した UI に、実際の機能を追加していく。

### 2-1: 2D キャンバス機能

- 外周ポリラインの手入力
  - キャンバス上で頂点をクリックして外周を作成（直角スナップ）
  - 頂点の追加・削除・移動
- 開口線の指定
  - 線分を引いて「ここからここまでは開口」を指定

### 2-2: 足場自動割付（既存ロジック連携）

- バックエンド API 呼び出し
  - 外周ポリラインをサーバに送信
  - 既存 Python ロジックで足場計算を実行
- 計算結果の 2D 表示
  - 支柱・スパンをキャンバスに描画

### 2-3: 3D / アイソメ / パース表示機能

- 建物アイソメ図の自動生成
  - 平面図外周＋立面情報から輪郭線ベースのアイソメ図を生成
  - 屋根形状・玄関など開口位置を線で表現
  - リアルな建物表現（窓・模様など）は行わない
- 3D ワイヤーフレーム表示
  - 建物外周を壁として押し出し
  - 屋根線を構成
- パース表示（透視図法）
  - ワイヤーフレームを維持しつつ遠近感のある表示
- 足場 3D 表示
  - 支柱・布材・手すり等を線として 3D 表示
  - 建物と同一 3D 空間に重ねて描画

### 2-4: 数量集計

- 部材種別×規格長さ×面別＋全体の数量を集計
- 「数量」タブで表形式表示
- CSV / Excel ダウンロード機能

---

## フェーズ2 チェックリスト

| 状態 | タスク | メモ |
|------|--------|------|
| [ ] | バックエンド雛形（FastAPI）を作成 | `backend/` ディレクトリ |
| [ ] | PostgreSQL 接続設定・初期スキーマ作成 | Alembic マイグレーション |
| [ ] | 既存足場ロジックを `scaffold_logic` としてモジュール化 | `calculate_scaffold(...)` |
| [ ] | 外周ポリラインの手入力（クリック＋直角スナップ）を実装 | 頂点の追加・削除・移動 |
| [ ] | 開口線指定機能を実装 | NG エリア設定 |
| [ ] | 外周ポリライン → 足場計算 API 連携を実装 | JSON 形式で送受信 |
| [ ] | 計算結果を 2D キャンバスに描画 | 支柱・スパン表示 |
| [ ] | 建物アイソメ図の自動生成ロジックを実装 | 輪郭線ベース、屋根・開口含む |
| [ ] | 3D ワイヤーフレーム表示を実装 | 建物＋足場 |
| [ ] | パース表示（透視図法）を実装 | 遠近感のある表示 |
| [ ] | 数量集計サービスを実装 | 部材種別×規格×面別＋全体 |
| [ ] | 数量タブに集計結果をテーブル表示 | ソート・フィルタ任意 |
| [ ] | CSV / Excel ダウンロード機能を実装 | 既存数量表互換の形式 |

---

## フェーズ3: 図面インポート＋外周編集

**目的**：PDF / 画像 / DXF 図面をベースに、外周を決められるようにする。

- 図面アップロード機能
  - 案件ごとに PDF / 画像 / DXF をアップロードし、ストレージに保存
  - 平面図をキャンバス背景として表示
  - 参照用図面ビューアで別ウィンドウ表示
- スケール設定
  - 寸法線上2点クリック＋実距離入力でスケールを決定
- 外周候補抽出（ルールベース）
  - OpenCV / ezdxf を使って外周候補の線を検出
  - ユーザーが頂点を修正して確定
- 高さ条件の入力
  - 階数・階高・軒高などを「建物・図面」タブから入力

---

## フェーズ4: AI エージェント導入（Claude SDK）

**目的**：AI による図面理解・条件提案・チャット修正を導入し、操作効率を上げる。

- claude-agent-sdk-python 統合
  - バックエンドにエージェント層を追加し、ツール（足場計算・図面解析）を登録
  - フロントのチャットタブと WebSocket 等で接続
- 図面解析の AI 補助
  - 「外周候補」「高さ候補」をエージェントが提案
- チャットによる条件変更
  - 「南面を縮める」「スパンを広げる」「高さを上げる」などの指示に対応
- ログ・学習データ蓄積
  - 初期案と最終案の差分を保存

---

## フェーズ5: 案件管理画面（Screen A）

**目的**：案件の一覧・作成・削除機能を実装する。

- 案件一覧画面 UI
  - 案件名／住所／作成日／更新日／ステータスを表示
  - 「新規案件作成」「開く」「削除」ボタン
- 案件データの永続化
  - 外周形状・条件・足場結果・数量を DB に保存
  - 案件の再読み込み機能
- 画面遷移
  - Screen A ↔ Screen B の基本フロー完成

---

## フェーズ6: UI 改良・ワークフロー最適化

**目的**：実務での使い勝手を上げる細かな改善を行う。

- チャットプリセットボタン
  - よく使う指示をボタン化し、1クリックで呼べるようにする
- 履歴・ロールバック
  - 自動割付や大きな条件変更ごとにスナップショットを取り、戻せるようにする
- 数量表フォーマットの調整
  - 実際の運用で必要になった列や並び順を反映

---

## フェーズ7: 拡張（AR・立面展開図・オンプレLLM など）

**目的**：MVP の枠を超えた高度な機能を段階的に追加。

- AR / ジェスチャー拡張
  - WebXR + 手検出（MediaPipe 等）によるブラウザベース AR
  - もしくは iOS / Android アプリで 3D モデルを AR 表示
- 立面足場展開図生成
  - 3D 足場モデルから各方位の立面展開図を自動生成し、PDF 出力
- 完全オンプレ LLM への移行
  - 情報ポリシー上必要であれば、Claude から自社ホスト LLM へ段階的に移行
- 複数ユーザー / SaaS 化
  - ユーザー管理、課金、チーム共有機能などを追加

---

## 優先順位の目安

1. **フェーズ0〜1**：キャンバス画面（Screen B）の UI を完成させる
2. **フェーズ2**：UI に実機能（足場計算・3D表示・数量集計）を追加
3. **フェーズ3**：図面インポートで実務に使える状態にする
4. **フェーズ4**：AI 補助で業務効率を上げる
5. **フェーズ5**：案件管理機能を追加
6. **フェーズ6**：使い勝手の改善
7. **フェーズ7**：AR やオンプレ LLM など、より長期の投資テーマ
