# 実装ロードマップ（MVP → 拡張）

このドキュメントは、足場SaaSツールの開発ロードマップを大きく段階ごとに整理したものです。  
実際のスケジュールは開発リソースに応じて調整してください。

---

## フェーズ0: プロトタイプ準備・環境構築

**目的**：小さく動く最低限のパイプラインを作り、全体像を動かしながら設計を固める。

- リポジトリ / プロジェクトセットアップ  
  - フロントエンド（Vite + React + TypeScript）の雛形作成。  
  - バックエンド（FastAPI + Python）の雛形作成。  
  - DB（PostgreSQL）の初期スキーマ（案件テーブル程度）作成。  
- 既存足場ロジックのラップ  
  - 既存 Python コードを `scaffold_logic` パッケージとして整理。  
  - ダミーの外周（単純な矩形）を入力として、足場計算が API 経由で呼べる状態にする。  
- 簡易キャンバス表示  
  - フロント側で 2D キャンバスを表示し、仮の四角形足場を線で描けるようにする。

---

## フェーズ1: 極小 MVP（外周手入力＋自動割付＋数量表示）

**目的**：AI や図面解析を使わなくても、  
「外周を手で入力 → 自動割付 → 数量確認」までを通せる状態にする。

- 外周ポリラインの手入力  
  - キャンバス上で頂点をクリックして外周を作成（直角スナップ）。  
  - 外周形状をサーバに送信できるようにする。  
- 足場自動割付（既存ロジック連携）  
  - 外周から最大外接矩形＋入隅 / 出隅を算出し、既存ロジックに渡す処理を実装。  
  - 計算結果を 2D 足場配置としてキャンバスに表示。  
- 数量集計  
  - 計算結果から、部材種別×規格長さ×面別＋全体の数量を集計し、「数量」タブで表示。  
  - CSV / Excel でダウンロード可能にする。  
- 案件保存・読み込み  
  - 外周形状・条件・数量を DB に保存し、再度開けるようにする。

※この段階で「外周直角ポリラインさえ入力すれば、今のロジックをブラウザから使える」状態になる。

---

## フェーズ2: 図面インポート＋外周編集

**目的**：PDF / 画像 / DXF 図面をベースに、外周を AI 補助付きで決められるようにする。

- 図面アップロード機能  
  - 案件ごとに PDF / 画像 / DXF をアップロードし、ストレージに保存。  
  - 平面図をキャンバス背景として表示。  
- スケール設定  
  - 寸法線上2点クリック＋実距離入力でスケールを決定。  
- 外周候補抽出（第一段階：ルールベース）  
  - OpenCV / ezdxf を使って外周候補の線を検出し、ポリライン候補として描画。  
  - ユーザーが頂点を修正して確定できるようにする。  
- 高さ条件の手入力 UI  
  - 階数・階高・軒高などを「建物・図面」タブから手入力できるようにする。

---

## フェーズ3: AI エージェント導入（Claude SDK）

**目的**：AI による図面理解・条件提案・チャット修正を導入し、操作効率を上げる。

- claude-agent-sdk-python 統合  
  - バックエンドにエージェント層を追加し、ツール（足場計算・図面解析）を登録。  
  - フロントのチャットタブと WebSocket 等で接続。  
- 図面解析の AI 補助  
  - 「外周候補」「高さ候補」をエージェントが提案し、ユーザーが確認・採用できるようにする。  
- チャットによる条件変更  
  - 「南面を縮める」「スパンを広げる」「高さを上げる」などの指示に対応。  
  - エージェントが条件を更新し、足場計算 API を再呼び出し。  
- ログ・学習データ蓄積  
  - 初期案と最終案の差分を保存し、将来の初期案改善に備える。

---

## フェーズ4: 3D ワイヤーフレーム統合

**目的**：建物外周＋屋根形状と足場を 3D ワイヤーフレームで確認できるようにする。

- 建物 3D モデル生成  
  - 外周ポリラインと高さ条件から壁の押し出しモデルを生成。  
  - 立面情報から屋根の最高高さ・形状（簡易）を再現。  
- 足場 3D モデル生成  
  - 足場計算結果から支柱・布材・手すりなどを線分として 3D 化。  
- Three.js 画面統合  
  - 「3D」タブで建物＋足場をワイヤーフレーム表示。  
  - マウス操作で回転・ズーム・平行移動ができるようにする。

---

## フェーズ5: UI 改良・ワークフロー最適化

**目的**：実務での使い勝手を上げる細かな改善を行う。

- チャットプリセットボタン  
  - よく使う指示をボタン化し、1クリックで呼べるようにする。  
- 履歴・ロールバック  
  - 自動割付や大きな条件変更ごとにスナップショットを取り、戻せるようにする。  
- 数量表フォーマットの調整  
  - 実際の運用で必要になった列や並び順を反映する。

---

## フェーズ6: 拡張（AR・立面展開図・オンプレLLM など）

**目的**：MVP の枠を超えた高度な機能を段階的に追加。

- AR / ジェスチャー拡張（別プロジェクト級）  
  - WebXR + 手検出（MediaPipe 等）によるブラウザベース AR。  
  - もしくは iOS / Android アプリで 3D モデルを AR 表示。  
- 立面足場展開図生成  
  - 3D 足場モデルから各方位の立面展開図を自動生成し、PDF 出力。  
- 完全オンプレ LLM への移行  
  - 情報ポリシー上必要であれば、Claude から自社ホスト LLM へ段階的に移行する。  
- 複数ユーザー / SaaS 化  
  - ユーザー管理、課金、チーム共有機能などを追加。

---

## 優先順位の目安

1. フェーズ0〜1：最小構成で「今のロジックを GUI から使える」状態にする  
2. フェーズ2〜3：図面ベースの外周決定と AI 補助で業務効率を上げる  
3. フェーズ4：3D ワイヤーフレームで立体的な確認を可能にする  
4. フェーズ5：使い勝手の改善  
5. フェーズ6：AR やオンプレ LLM など、より長期の投資テーマ

